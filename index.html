<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Taller Completo de Distribución Normal - Edición Expandida</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mathjs@11.11.0/lib/browser/math.min.js"></script>
    <style>
        @page {
            size: A4;
            margin: 1cm;
        }
        body {
            font-family: 'Arial', sans-serif;
            line-height: 1.4;
        }
        .formula {
            background: #f8f9fa;
            padding: 8px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            border-left: 4px solid #3b82f6;
        }
        .help-box {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
        }
        .question-card {
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            background: white;
        }
        .correct { border-color: #10b981; background-color: #ecfdf5; }
        .incorrect { border-color: #ef4444; background-color: #fef2f2; }
        .z-table {
            font-size: 10px;
            border-collapse: collapse;
        }
        .z-table td, .z-table th {
            border: 1px solid #ddd;
            padding: 2px 4px;
            text-align: center;
        }
        @media print {
            .no-print { display: none; }
            .question-card { page-break-inside: avoid; }
        }
    </style>
</head>
<body class="bg-gray-50">
    <div class="container mx-auto p-4 max-w-4xl">
        <!-- Header -->
        <div class="bg-gradient-to-r from-blue-600 to-purple-600 text-white p-6 rounded-lg mb-6">
            <h1 class="text-3xl font-bold mb-2"><i class="fas fa-chart-line mr-3"></i>Taller de Distribución Normal</h1>
            <p class="text-lg">Ejercicios Farmacéuticos y Estadísticos Aplicados</p>
            <div class="mt-4 grid grid-cols-3 gap-4 text-center">
                <div class="bg-white bg-opacity-20 rounded p-2">
                    <div class="text-2xl font-bold" id="progress">0/40</div>
                    <div class="text-sm">Progreso</div>
                </div>
                <div class="bg-white bg-opacity-20 rounded p-2">
                    <div class="text-2xl font-bold" id="score">0.0/50</div>
                    <div class="text-sm">Puntuación</div>
                </div>
                <div class="bg-white bg-opacity-20 rounded p-2">
                    <div class="text-2xl font-bold" id="percentage">0%</div>
                    <div class="text-sm">Porcentaje</div>
                </div>
            </div>
        </div>

        <!-- Tools Section -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-4 mb-6">
            <!-- Z-Score Calculator -->
            <div class="bg-white p-4 rounded-lg shadow">
                <h3 class="font-bold text-lg mb-3"><i class="fas fa-calculator text-blue-500 mr-2"></i>Calculadora Z</h3>
                <div class="space-y-2">
                    <input type="number" id="calc-x" placeholder="Valor (x)" class="w-full p-2 border rounded">
                    <input type="number" id="calc-mu" placeholder="Media (μ)" class="w-full p-2 border rounded">
                    <input type="number" id="calc-sigma" placeholder="Desv. Est. (σ)" class="w-full p-2 border rounded">
                    <button onclick="calculateZ()" class="w-full bg-blue-500 text-white p-2 rounded hover:bg-blue-600">
                        Calcular Z
                    </button>
                    <div id="z-result" class="text-center font-bold text-lg"></div>
                </div>
            </div>

            <!-- Normal Distribution Visualizer -->
            <div class="bg-white p-4 rounded-lg shadow">
                <h3 class="font-bold text-lg mb-3"><i class="fas fa-chart-area text-green-500 mr-2"></i>Visualizador</h3>
                <canvas id="normalChart" width="200" height="150"></canvas>
            </div>

            <!-- Z-Table Quick Reference -->
            <div class="bg-white p-4 rounded-lg shadow">
                <h3 class="font-bold text-lg mb-3"><i class="fas fa-table text-purple-500 mr-2"></i>Tabla Z Rápida</h3>
                <input type="number" id="z-lookup" placeholder="Valor Z" step="0.01" class="w-full p-2 border rounded mb-2">
                <button onclick="lookupZ()" class="w-full bg-purple-500 text-white p-2 rounded hover:bg-purple-600">
                    Buscar P(Z ≤ z)
                </button>
                <div id="z-lookup-result" class="text-center font-bold text-lg mt-2"></div>
            </div>
        </div>

        <!-- Question Display -->
        <div id="question-container" class="question-card">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold">Pregunta <span id="question-number">1</span></h2>
                <button id="help-btn" onclick="toggleHelp()" class="bg-yellow-500 text-white px-4 py-2 rounded hover:bg-yellow-600">
                    <i class="fas fa-lightbulb mr-2"></i>Ayuda
                </button>
            </div>
            
            <div id="help-section" class="help-box" style="display: none;">
                <h4 class="font-bold mb-2"><i class="fas fa-info-circle mr-2"></i>Conceptos y Fórmulas</h4>
                <div id="help-content"></div>
            </div>

            <div id="question-text" class="text-lg mb-4"></div>
            <div id="question-options" class="space-y-2"></div>
            
            <div class="flex justify-between mt-6">
                <button id="prev-btn" onclick="previousQuestion()" class="bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600" disabled>
                    <i class="fas fa-chevron-left mr-2"></i>Anterior
                </button>
                <button id="next-btn" onclick="nextQuestion()" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
                    Siguiente<i class="fas fa-chevron-right ml-2"></i>
                </button>
            </div>
        </div>

        <!-- Results Section -->
        <div id="results-section" style="display: none;" class="bg-white p-6 rounded-lg shadow mt-6">
            <h2 class="text-2xl font-bold text-center mb-4">
                <i class="fas fa-trophy text-yellow-500 mr-3"></i>Resultados Finales
            </h2>
            <div id="final-results" class="text-center"></div>
            <div id="detailed-results" class="mt-6"></div>
        </div>

        <!-- Full Z-Table -->
        <div class="bg-white p-4 rounded-lg shadow mt-6">
            <h3 class="font-bold text-lg mb-3 text-center">
                <i class="fas fa-table text-blue-500 mr-2"></i>Tabla de Distribución Normal Estándar
            </h3>
            <div class="overflow-x-auto">
                <table class="z-table mx-auto">
                    <thead>
                        <tr>
                            <th>z</th>
                            <th>0.00</th><th>0.01</th><th>0.02</th><th>0.03</th><th>0.04</th>
                            <th>0.05</th><th>0.06</th><th>0.07</th><th>0.08</th><th>0.09</th>
                        </tr>
                    </thead>
                    <tbody id="z-table-body">
                        <!-- Z-table will be populated by JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        let currentQuestion = 0;
        let answers = {};
        let totalScore = 0;
        let helpVisible = false;

        const questions = [
            {
                text: "En un análisis de tamaño de partículas para una formulación farmacéutica, se encuentra que el diámetro promedio es de 100 μm con una desviación estándar de 15 μm, siguiendo una distribución normal. ¿Cuál es la probabilidad de que una partícula seleccionada al azar tenga un tamaño entre 85 y 115 μm?",
                type: "multiple",
                options: ["0.4972", "0.6826", "0.7258", "0.8413"],
                correct: 1,
                help: {
                    concept: "Probabilidad entre dos valores en distribución normal",
                    formula: "P(a < X < b) = P((a-μ)/σ < Z < (b-μ)/σ) = Φ(z₂) - Φ(z₁)",
                    method: "1. Calcular z₁ = (85-100)/15 = -1\n2. Calcular z₂ = (115-100)/15 = 1\n3. P(-1 < Z < 1) = Φ(1) - Φ(-1) = 0.8413 - 0.1587 = 0.6826"
                }
            },
            {
                text: "En el control de calidad de un medicamento, la potencia sigue una distribución normal con media de 95 mg y desviación estándar de 3 mg. ¿Qué porcentaje de lotes tendrá una potencia superior a 98 mg?",
                type: "multiple",
                options: ["15.87%", "16.87%", "84.13%", "83.13%"],
                correct: 0,
                help: {
                    concept: "Probabilidad mayor que un valor específico",
                    formula: "P(X > a) = 1 - P(X ≤ a) = 1 - Φ((a-μ)/σ)",
                    method: "1. z = (98-95)/3 = 1\n2. P(Z > 1) = 1 - Φ(1) = 1 - 0.8413 = 0.1587 = 15.87%"
                }
            },
            {
                text: "En un estudio de estabilidad de medicamentos, el tiempo de degradación sigue una distribución normal con μ = 24 meses y σ = 4 meses. ¿Cuál es la probabilidad de que un medicamento se degrade antes de 20 meses?",
                type: "multiple",
                options: ["0.1587", "0.3085", "0.6915", "0.8413"],
                correct: 0,
                help: {
                    concept: "Probabilidad menor que un valor específico",
                    formula: "P(X < a) = Φ((a-μ)/σ)",
                    method: "1. z = (20-24)/4 = -1\n2. P(Z < -1) = Φ(-1) = 0.1587"
                }
            },
            {
                text: "En la síntesis de un principio activo, el rendimiento sigue una distribución normal con media de 85% y desviación estándar de 5%. ¿Qué valor de rendimiento es superado por el 90% de los procesos?",
                type: "input",
                answer: 78.6,
                tolerance: 0.5,
                help: {
                    concept: "Percentil inferior de la distribución normal",
                    formula: "x = μ + z₀.₁₀ × σ (donde z₀.₁₀ = -1.28)",
                    method: "1. Para el percentil 10: z = -1.28\n2. x = 85 + (-1.28) × 5 = 85 - 6.4 = 78.6%"
                }
            },
            {
                text: "En un ensayo de disolución, el porcentaje disuelto a los 30 minutos sigue una distribución normal con μ = 78% y σ = 6%. ¿Cuál es la probabilidad de obtener valores entre 72% y 84%?",
                type: "multiple",
                options: ["0.6826", "0.9544", "0.3829", "0.7258"],
                correct: 0,
                help: {
                    concept: "Probabilidad entre dos valores simétricos",
                    formula: "P(μ-σ < X < μ+σ) ≈ 0.6826 (regla empírica)",
                    method: "72% = 78% - 6% y 84% = 78% + 6%, entonces es μ ± σ = 68.26%"
                }
            },
            {
                text: "En el análisis de pureza de un compuesto farmacéutico, se obtiene una distribución normal con media de 99.2% y desviación estándar de 0.8%. ¿Cuál es la probabilidad de que una muestra tenga pureza inferior a 98%?",
                type: "multiple",
                options: ["0.0668", "0.9332", "0.1587", "0.8413"],
                correct: 0,
                help: {
                    concept: "Probabilidad en cola inferior",
                    formula: "P(X < a) = Φ((a-μ)/σ)",
                    method: "1. z = (98-99.2)/0.8 = -1.5\n2. P(Z < -1.5) = 0.0668"
                }
            },
            {
                text: "En un proceso de granulación, el tamaño medio de gránulo sigue una distribución normal con μ = 250 μm y σ = 25 μm. ¿Qué porcentaje de gránulos tendrá un tamaño entre 200 y 300 μm?",
                type: "multiple",
                options: ["95.44%", "99.73%", "68.26%", "84.13%"],
                correct: 0,
                help: {
                    concept: "Regla empírica 2σ",
                    formula: "P(μ-2σ < X < μ+2σ) ≈ 0.9544",
                    method: "200 = 250-50 = μ-2σ y 300 = 250+50 = μ+2σ, entonces 95.44%"
                }
            },
            {
                text: "En el control de pH de una solución farmacéutica, se obtiene una distribución normal con media de 7.0 y desviación estándar de 0.2. ¿Cuál es el valor de pH que es superado por el 95% de las mediciones?",
                type: "input",
                answer: 6.67,
                tolerance: 0.02,
                help: {
                    concept: "Percentil 5 (cola inferior)",
                    formula: "x = μ + z₀.₀₅ × σ (donde z₀.₀₅ = -1.645)",
                    method: "1. Para percentil 5: z = -1.645\n2. x = 7.0 + (-1.645) × 0.2 = 6.67"
                }
            },
            {
                text: "En un estudio de bioequivalencia, la concentración máxima en plasma sigue una distribución normal con μ = 45 ng/mL y σ = 8 ng/mL. ¿Cuál es la probabilidad de que un sujeto tenga una concentración superior a 60 ng/mL?",
                type: "multiple",
                options: ["0.0287", "0.9713", "0.1587", "0.0618"],
                correct: 0,
                help: {
                    concept: "Probabilidad en cola superior",
                    formula: "P(X > a) = 1 - Φ((a-μ)/σ)",
                    method: "1. z = (60-45)/8 = 1.875\n2. P(Z > 1.875) ≈ 0.0287"
                }
            },
            {
                text: "En la fabricación de comprimidos, el peso promedio es de 500 mg con desviación estándar de 15 mg, distribución normal. ¿Qué porcentaje de comprimidos tendrá un peso entre 470 y 530 mg?",
                type: "multiple",
                options: ["95.44%", "99.73%", "68.26%", "84.13%"],
                correct: 0,
                help: {
                    concept: "Intervalo de 2 desviaciones estándar",
                    formula: "P(μ-2σ < X < μ+2σ) = 0.9544",
                    method: "470 = 500-30 = μ-2σ y 530 = 500+30 = μ+2σ"
                }
            },
            {
                text: "En el análisis de viscosidad de un jarabe, se obtiene una distribución normal con media de 2500 cP y desviación estándar de 200 cP. ¿Cuál es la probabilidad de obtener una viscosidad inferior a 2200 cP?",
                type: "multiple",
                options: ["0.0668", "0.1587", "0.9332", "0.8413"],
                correct: 0,
                help: {
                    concept: "Probabilidad en cola inferior extrema",
                    formula: "P(X < a) = Φ((a-μ)/σ)",
                    method: "1. z = (2200-2500)/200 = -1.5\n2. P(Z < -1.5) = 0.0668"
                }
            },
            {
                text: "En un proceso de liofilización, el tiempo de secado sigue una distribución normal con μ = 12 horas y σ = 2 horas. ¿Qué tiempo de secado es superado por el 75% de los procesos?",
                type: "input",
                answer: 10.65,
                tolerance: 0.1,
                help: {
                    concept: "Percentil 25 (cuartil inferior)",
                    formula: "x = μ + z₀.₂₅ × σ (donde z₀.₂₅ = -0.675)",
                    method: "1. Para percentil 25: z = -0.675\n2. x = 12 + (-0.675) × 2 = 10.65 horas"
                }
            },
            {
                text: "En el control de dureza de comprimidos, la fuerza de ruptura sigue una distribución normal con media de 8 kg y desviación estándar de 1.2 kg. ¿Cuál es la probabilidad de que un comprimido tenga dureza entre 6.5 y 9.5 kg?",
                type: "multiple",
                options: ["0.7888", "0.8944", "0.6826", "0.9544"],
                correct: 0,
                help: {
                    concept: "Probabilidad entre valores asimétricos",
                    formula: "P(a < X < b) = Φ(z₂) - Φ(z₁)",
                    method: "1. z₁ = (6.5-8)/1.2 = -1.25, z₂ = (9.5-8)/1.2 = 1.25\n2. P(-1.25 < Z < 1.25) = 0.8944 - 0.1056 = 0.7888"
                }
            },
            {
                text: "En un ensayo de estabilidad acelerada, la degradación a 6 meses sigue una distribución normal con μ = 2.5% y σ = 0.6%. ¿Cuál es la probabilidad de que la degradación sea superior al 3.5%?",
                type: "multiple",
                options: ["0.0478", "0.9522", "0.1587", "0.0287"],
                correct: 0,
                help: {
                    concept: "Probabilidad en cola superior",
                    formula: "P(X > a) = 1 - Φ((a-μ)/σ)",
                    method: "1. z = (3.5-2.5)/0.6 = 1.67\n2. P(Z > 1.67) = 1 - 0.9522 = 0.0478"
                }
            },
            {
                text: "En la producción de cápsulas, el contenido de principio activo sigue una distribución normal con media de 250 mg y desviación estándar de 8 mg. ¿Qué contenido es superado por el 90% de las cápsulas?",
                type: "input",
                answer: 239.76,
                tolerance: 0.5,
                help: {
                    concept: "Percentil 10",
                    formula: "x = μ + z₀.₁₀ × σ (donde z₀.₁₀ = -1.28)",
                    method: "1. Para percentil 10: z = -1.28\n2. x = 250 + (-1.28) × 8 = 239.76 mg"
                }
            },
            {
                text: "En el análisis de partículas por difracción láser, el D₅₀ sigue una distribución normal con μ = 15 μm y σ = 2.5 μm. ¿Cuál es la probabilidad de obtener un D₅₀ entre 12 y 18 μm?",
                type: "multiple",
                options: ["0.7698", "0.8849", "0.6826", "0.9544"],
                correct: 0,
                help: {
                    concept: "Probabilidad simétrica alrededor de la media",
                    formula: "P(μ-1.2σ < X < μ+1.2σ)",
                    method: "1. z₁ = (12-15)/2.5 = -1.2, z₂ = (18-15)/2.5 = 1.2\n2. P(-1.2 < Z < 1.2) = 0.8849 - 0.1151 = 0.7698"
                }
            },
            {
                text: "En un proceso de recubrimiento entérico, el espesor de película sigue una distribución normal con media de 25 μm y desviación estándar de 4 μm. ¿Qué porcentaje de comprimidos tendrá un espesor inferior a 20 μm?",
                type: "multiple",
                options: ["10.56%", "15.87%", "21.19%", "30.85%"],
                correct: 0,
                help: {
                    concept: "Probabilidad en cola inferior",
                    formula: "P(X < a) = Φ((a-μ)/σ)",
                    method: "1. z = (20-25)/4 = -1.25\n2. P(Z < -1.25) = 0.1056 = 10.56%"
                }
            },
            {
                text: "En el control de uniformidad de contenido, la variación sigue una distribución normal con μ = 100% y σ = 3%. ¿Cuál es el rango que contiene el 99.73% central de los valores?",
                type: "multiple",
                options: ["91% - 109%", "94% - 106%", "97% - 103%", "85% - 115%"],
                correct: 0,
                help: {
                    concept: "Regla empírica 3σ",
                    formula: "P(μ-3σ < X < μ+3σ) = 0.9973",
                    method: "μ ± 3σ = 100 ± 3(3) = 100 ± 9 = 91% a 109%"
                }
            },
            {
                text: "En un ensayo de disolución para comprimidos de liberación inmediata, el porcentaje disuelto a los 15 minutos sigue una distribución normal con μ = 85% y σ = 5%. ¿Cuál es la probabilidad de cumplir la especificación (≥75%)?",
                type: "multiple",
                options: ["97.72%", "95.44%", "84.13%", "99.38%"],
                correct: 0,
                help: {
                    concept: "Probabilidad de cumplir especificación",
                    formula: "P(X ≥ 75) = 1 - P(X < 75) = 1 - Φ((75-μ)/σ)",
                    method: "1. z = (75-85)/5 = -2\n2. P(Z ≥ -2) = 1 - 0.0228 = 0.9772 = 97.72%"
                }
            },
            {
                text: "En la determinación de humedad residual por Karl Fischer, los resultados siguen una distribución normal con media de 0.8% y desviación estándar de 0.15%. ¿Qué valor de humedad es superado por el 95% de las determinaciones?",
                type: "input",
                answer: 0.553,
                tolerance: 0.01,
                help: {
                    concept: "Percentil 5",
                    formula: "x = μ + z₀.₀₅ × σ (donde z₀.₀₅ = -1.645)",
                    method: "1. Para percentil 5: z = -1.645\n2. x = 0.8 + (-1.645) × 0.15 = 0.553%"
                }
            },
            {
                text: "En un proceso de síntesis orgánica, el rendimiento sigue una distribución normal con μ = 78% y σ = 6%. ¿Cuál es la probabilidad de obtener un rendimiento entre 70% y 86%?",
                type: "multiple",
                options: ["0.8164", "0.7698", "0.9044", "0.6826"],
                correct: 0,
                help: {
                    concept: "Probabilidad entre valores simétricos",
                    formula: "P(μ-4σ/3 < X < μ+4σ/3)",
                    method: "1. z₁ = (70-78)/6 = -1.33, z₂ = (86-78)/6 = 1.33\n2. P(-1.33 < Z < 1.33) = 0.9082 - 0.0918 = 0.8164"
                }
            },
            {
                text: "En el análisis de densidad de comprimidos, se obtiene una distribución normal con media de 1.25 g/cm³ y desviación estándar de 0.08 g/cm³. ¿Cuál es la probabilidad de que un comprimido tenga densidad superior a 1.35 g/cm³?",
                type: "multiple",
                options: ["10.56%", "15.87%", "5.48%", "21.19%"],
                correct: 0,
                help: {
                    concept: "Probabilidad en cola superior",
                    formula: "P(X > a) = 1 - Φ((a-μ)/σ)",
                    method: "1. z = (1.35-1.25)/0.08 = 1.25\n2. P(Z > 1.25) = 1 - 0.8944 = 0.1056 = 10.56%"
                }
            },
            {
                text: "En un ensayo de permeabilidad de membranas, el flujo de difusión sigue una distribución normal con μ = 2.8 μg/cm²/h y σ = 0.4 μg/cm²/h. ¿Qué flujo es superado por el 80% de las mediciones?",
                type: "input",
                answer: 2.464,
                tolerance: 0.01,
                help: {
                    concept: "Percentil 20",
                    formula: "x = μ + z₀.₂₀ × σ (donde z₀.₂₀ = -0.84)",
                    method: "1. Para percentil 20: z = -0.84\n2. x = 2.8 + (-0.84) × 0.4 = 2.464 μg/cm²/h"
                }
            },
            {
                text: "En el control de friabilidad de comprimidos, la pérdida de peso sigue una distribución normal con media de 0.5% y desviación estándar de 0.12%. ¿Cuál es la probabilidad de que la friabilidad sea inferior a 0.3%?",
                type: "multiple",
                options: ["4.78%", "9.68%", "15.87%", "2.28%"],
                correct: 0,
                help: {
                    concept: "Probabilidad en cola inferior",
                    formula: "P(X < a) = Φ((a-μ)/σ)",
                    method: "1. z = (0.3-0.5)/0.12 = -1.67\n2. P(Z < -1.67) = 0.0478 = 4.78%"
                }
            },
            {
                text: "En la medición de índice de refracción de una solución, se obtiene una distribución normal con μ = 1.3350 y σ = 0.0008. ¿Cuál es la probabilidad de obtener un valor entre 1.3340 y 1.3360?",
                type: "multiple",
                options: ["78.88%", "89.44%", "95.44%", "68.26%"],
                correct: 0,
                help: {
                    concept: "Probabilidad simétrica",
                    formula: "P(μ-1.25σ < X < μ+1.25σ)",
                    method: "1. z₁ = (1.3340-1.3350)/0.0008 = -1.25\n2. z₂ = (1.3360-1.3350)/0.0008 = 1.25\n3. P(-1.25 < Z < 1.25) = 0.7888"
                }
            },
            {
                text: "En un proceso de cristalización, el tamaño de cristal sigue una distribución normal con media de 180 μm y desviación estándar de 22 μm. ¿Qué porcentaje de cristales tendrá un tamaño superior a 200 μm?",
                type: "multiple",
                options: ["18.14%", "15.87%", "21.19%", "30.85%"],
                correct: 0,
                help: {
                    concept: "Probabilidad en cola superior",
                    formula: "P(X > a) = 1 - Φ((a-μ)/σ)",
                    method: "1. z = (200-180)/22 = 0.91\n2. P(Z > 0.91) = 1 - 0.8186 = 0.1814 = 18.14%"
                }
            },
            {
                text: "En el análisis de estabilidad térmica, la temperatura de descomposición sigue una distribución normal con μ = 285°C y σ = 12°C. ¿Cuál es el valor de temperatura que es superado por el 99% de las muestras?",
                type: "input",
                answer: 257.08,
                tolerance: 0.5,
                help: {
                    concept: "Percentil 1",
                    formula: "x = μ + z₀.₀₁ × σ (donde z₀.₀₁ = -2.33)",
                    method: "1. Para percentil 1: z = -2.33\n2. x = 285 + (-2.33) × 12 = 257.08°C"
                }
            },
            {
                text: "En un ensayo de biodisponibilidad, el AUC (área bajo la curva) sigue una distribución normal con media de 450 ng·h/mL y desviación estándar de 75 ng·h/mL. ¿Cuál es la probabilidad de obtener un AUC entre 300 y 600 ng·h/mL?",
                type: "multiple",
                options: ["95.44%", "97.72%", "99.73%", "68.26%"],
                correct: 0,
                help: {
                    concept: "Regla empírica 2σ",
                    formula: "P(μ-2σ < X < μ+2σ) = 0.9544",
                    method: "300 = 450-150 = μ-2σ y 600 = 450+150 = μ+2σ"
                }
            },
            {
                text: "En el control de turbidez de una solución inyectable, la medición sigue una distribución normal con μ = 2.5 NTU y σ = 0.3 NTU. ¿Cuál es la probabilidad de que la turbidez sea superior a 3.0 NTU?",
                type: "multiple",
                options: ["4.78%", "9.68%", "15.87%", "2.28%"],
                correct: 0,
                help: {
                    concept: "Probabilidad en cola superior",
                    formula: "P(X > a) = 1 - Φ((a-μ)/σ)",
                    method: "1. z = (3.0-2.5)/0.3 = 1.67\n2. P(Z > 1.67) = 1 - 0.9522 = 0.0478 = 4.78%"
                }
            },
            {
                text: "En la determinación de potencia por HPLC, los resultados siguen una distribución normal con media de 102.5% y desviación estándar de 2.8%. ¿Qué valor de potencia es superado por el 85% de las determinaciones?",
                type: "input",
                answer: 99.59,
                tolerance: 0.1,
                help: {
                    concept: "Percentil 15",
                    formula: "x = μ + z₀.₁₅ × σ (donde z₀.₁₅ = -1.04)",
                    method: "1. Para percentil 15: z = -1.04\n2. x = 102.5 + (-1.04) × 2.8 = 99.59%"
                }
            },
            {
                text: "En un proceso de encapsulación, el peso de cápsulas vacías sigue una distribución normal con μ = 65 mg y σ = 2.5 mg. ¿Cuál es la probabilidad de que una cápsula tenga un peso entre 62 y 68 mg?",
                type: "multiple",
                options: ["76.98%", "89.44%", "68.26%", "95.44%"],
                correct: 0,
                help: {
                    concept: "Probabilidad simétrica",
                    formula: "P(μ-1.2σ < X < μ+1.2σ)",
                    method: "1. z₁ = (62-65)/2.5 = -1.2, z₂ = (68-65)/2.5 = 1.2\n2. P(-1.2 < Z < 1.2) = 0.8849 - 0.1151 = 0.7698"
                }
            },
            {
                text: "En el análisis de residuos de solventes por cromatografía de gases, la concentración de etanol sigue una distribución normal con μ = 450 ppm y σ = 85 ppm. ¿Cuál es la probabilidad de que la concentración sea inferior a 300 ppm?",
                type: "multiple",
                options: ["3.92%", "7.64%", "15.87%", "1.79%"],
                correct: 0,
                help: {
                    concept: "Probabilidad en cola inferior",
                    formula: "P(X < a) = Φ((a-μ)/σ)",
                    method: "1. z = (300-450)/85 = -1.76\n2. P(Z < -1.76) = 0.0392 = 3.92%"
                }
            },
            {
                text: "En un ensayo de velocidad de disolución intrínseca, la velocidad sigue una distribución normal con media de 0.25 mg/cm²/min y desviación estándar de 0.04 mg/cm²/min. ¿Qué velocidad es superada por el 70% de las mediciones?",
                type: "input",
                answer: 0.229,
                tolerance: 0.005,
                help: {
                    concept: "Percentil 30",
                    formula: "x = μ + z₀.₃₀ × σ (donde z₀.₃₀ = -0.52)",
                    method: "1. Para percentil 30: z = -0.52\n2. x = 0.25 + (-0.52) × 0.04 = 0.229 mg/cm²/min"
                }
            },
            {
                text: "En el control de endotoxinas bacterianas, los resultados siguen una distribución normal con μ = 0.8 EU/mL y σ = 0.15 EU/mL. ¿Cuál es la probabilidad de que el nivel de endotoxinas sea superior a 1.0 EU/mL?",
                type: "multiple",
                options: ["9.12%", "15.87%", "18.41%", "5.48%"],
                correct: 0,
                help: {
                    concept: "Probabilidad en cola superior",
                    formula: "P(X > a) = 1 - Φ((a-μ)/σ)",
                    method: "1. z = (1.0-0.8)/0.15 = 1.33\n2. P(Z > 1.33) = 1 - 0.9088 = 0.0912 = 9.12%"
                }
            },
            {
                text: "En la medición de ángulo de reposo para polvos farmacéuticos, se obtiene una distribución normal con media de 35° y desviación estándar de 4°. ¿Cuál es la probabilidad de obtener un ángulo entre 30° y 40°?",
                type: "multiple",
                options: ["78.88%", "89.44%", "68.26%", "95.44%"],
                correct: 0,
                help: {
                    concept: "Probabilidad simétrica",
                    formula: "P(μ-1.25σ < X < μ+1.25σ)",
                    method: "1. z₁ = (30-35)/4 = -1.25, z₂ = (40-35)/4 = 1.25\n2. P(-1.25 < Z < 1.25) = 0.8944 - 0.1056 = 0.7888"
                }
            },
            {
                text: "En un proceso de llenado aséptico, el volumen de llenado sigue una distribución normal con μ = 10.0 mL y σ = 0.08 mL. ¿Qué porcentaje de viales tendrá un volumen inferior a 9.9 mL?",
                type: "multiple",
                options: ["10.56%", "15.87%", "21.19%", "5.48%"],
                correct: 0,
                help: {
                    concept: "Probabilidad en cola inferior",
                    formula: "P(X < a) = Φ((a-μ)/σ)",
                    method: "1. z = (9.9-10.0)/0.08 = -1.25\n2. P(Z < -1.25) = 0.1056 = 10.56%"
                }
            },
            {
                text: "En el análisis de contenido microbiano, el log₁₀ de UFC/g sigue una distribución normal con μ = 2.5 y σ = 0.4. ¿Cuál es el valor de log₁₀(UFC/g) que es superado por el 95% de las muestras?",
                type: "input",
                answer: 1.842,
                tolerance: 0.01,
                help: {
                    concept: "Percentil 5",
                    formula: "x = μ + z₀.₀₅ × σ (donde z₀.₀₅ = -1.645)",
                    method: "1. Para percentil 5: z = -1.645\n2. x = 2.5 + (-1.645) × 0.4 = 1.842"
                }
            },
            {
                text: "En un ensayo de compatibilidad fármaco-excipiente, la pureza del principio activo a 3 meses sigue una distribución normal con media de 98.5% y desviación estándar de 0.8%. ¿Cuál es la probabilidad de que la pureza sea superior al 99.5%?",
                type: "multiple",
                options: ["10.56%", "15.87%", "21.19%", "5.48%"],
                correct: 0,
                help: {
                    concept: "Probabilidad en cola superior",
                    formula: "P(X > a) = 1 - Φ((a-μ)/σ)",
                    method: "1. z = (99.5-98.5)/0.8 = 1.25\n2. P(Z > 1.25) = 1 - 0.8944 = 0.1056 = 10.56%"
                }
            },
            {
                text: "En la determinación de densidad aparente de polvos, los resultados siguen una distribución normal con μ = 0.45 g/mL y σ = 0.06 g/mL. ¿Cuál es la probabilidad de obtener una densidad entre 0.35 y 0.55 g/mL?",
                type: "multiple",
                options: ["90.44%", "95.44%", "89.44%", "86.64%"],
                correct: 0,
                help: {
                    concept: "Probabilidad simétrica",
                    formula: "P(μ-5σ/3 < X < μ+5σ/3)",
                    method: "1. z₁ = (0.35-0.45)/0.06 = -1.67, z₂ = (0.55-0.45)/0.06 = 1.67\n2. P(-1.67 < Z < 1.67) = 0.9522 - 0.0478 = 0.9044"
                }
            }
        ];

        // Initialize the application
        window.onload = function() {
            populateZTable();
            createNormalChart();
            showQuestion(currentQuestion);
            updateProgress();
        };

        function populateZTable() {
            const tbody = document.getElementById('z-table-body');
            for (let z = 0.0; z <= 3.0; z += 0.1) {
                const row = document.createElement('tr');
                row.innerHTML = `<td>${z.toFixed(1)}</td>`;
                
                for (let j = 0; j <= 9; j++) {
                    const zValue = z + j * 0.01;
                    const prob = normalCDF(zValue);
                    row.innerHTML += `<td>${prob.toFixed(4)}</td>`;
                }
                tbody.appendChild(row);
            }
        }

        function normalCDF(z) {
            return 0.5 * (1 + erf(z / Math.sqrt(2)));
        }

        function erf(x) {
            const a1 =  0.254829592;
            const a2 = -0.284496736;
            const a3 =  1.421413741;
            const a4 = -1.453152027;
            const a5 =  1.061405429;
            const p  =  0.3275911;

            const sign = x < 0 ? -1 : 1;
            x = Math.abs(x);

            const t = 1.0 / (1.0 + p * x);
            const y = 1.0 - (((((a5 * t + a4) * t) + a3) * t + a2) * t + a1) * t * Math.exp(-x * x);

            return sign * y;
        }

        function calculateZ() {
            const x = parseFloat(document.getElementById('calc-x').value);
            const mu = parseFloat(document.getElementById('calc-mu').value);
            const sigma = parseFloat(document.getElementById('calc-sigma').value);
            
            if (!isNaN(x) && !isNaN(mu) && !isNaN(sigma) && sigma > 0) {
                const z = (x - mu) / sigma;
                const prob = normalCDF(z);
                document.getElementById('z-result').innerHTML = 
                    `z = ${z.toFixed(3)}<br>P(Z ≤ z) = ${prob.toFixed(4)}`;
            }
        }

        function lookupZ() {
            const z = parseFloat(document.getElementById('z-lookup').value);
            if (!isNaN(z)) {
                const prob = normalCDF(z);
                document.getElementById('z-lookup-result').innerHTML = 
                    `P(Z ≤ ${z}) = ${prob.toFixed(4)}`;
            }
        }

        function createNormalChart() {
            const ctx = document.getElementById('normalChart').getContext('2d');
            const data = [];
            const labels = [];
            
            for (let x = -4; x <= 4; x += 0.1) {
                labels.push(x.toFixed(1));
                data.push(normalPDF(x));
            }

            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Distribución Normal Estándar',
                        data: data,
                        borderColor: 'rgb(59, 130, 246)',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 0.5
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }

        function normalPDF(x) {
            return (1 / Math.sqrt(2 * Math.PI)) * Math.exp(-0.5 * x * x);
        }

        function showQuestion(index) {
            const question = questions[index];
            document.getElementById('question-number').textContent = index + 1;
            document.getElementById('question-text').textContent = question.text;
            
            const optionsContainer = document.getElementById('question-options');
            optionsContainer.innerHTML = '';
            
            if (question.type === 'multiple') {
                question.options.forEach((option, i) => {
                    const div = document.createElement('div');
                    div.className = 'flex items-center';
                    div.innerHTML = `
                        <input type="radio" id="opt${i}" name="answer" value="${i}" 
                               onchange="selectAnswer(${i})" class="mr-3">
                        <label for="opt${i}" class="text-lg cursor-pointer">${option}</label>
                    `;
                    optionsContainer.appendChild(div);
                });
            } else if (question.type === 'input') {
                const div = document.createElement('div');
                div.innerHTML = `
                    <label class="block text-lg mb-2">Ingresa tu respuesta:</label>
                    <input type="number" id="answer-input" step="any" 
                           onchange="selectAnswerInput()" 
                           class="w-full p-3 border-2 border-gray-300 rounded-lg text-lg">
                `;
                optionsContainer.appendChild(div);
            }
            
            // Load previous answer if exists
            if (answers[index]) {
                if (question.type === 'multiple') {
                    document.querySelector(`input[value="${answers[index].selected}"]`).checked = true;
                } else {
                    document.getElementById('answer-input').value = answers[index].selected;
                }
            }
            
            // Update navigation buttons
            document.getElementById('prev-btn').disabled = index === 0;
            document.getElementById('next-btn').textContent = 
                index === questions.length - 1 ? 'Finalizar' : 'Siguiente';
            
            // Update help content
            updateHelpContent(question.help);
        }

        function updateHelpContent(help) {
            const helpContent = document.getElementById('help-content');
            helpContent.innerHTML = `
                <div class="mb-3">
                    <strong>📋 Concepto:</strong> ${help.concept}
                </div>
                <div class="formula mb-3">
                    <strong>📐 Fórmula:</strong> ${help.formula}
                </div>
                <div>
                    <strong>🔍 Metodología:</strong><br>
                    <pre class="whitespace-pre-wrap text-sm mt-1">${help.method}</pre>
                </div>
            `;
        }

        function toggleHelp() {
            const helpSection = document.getElementById('help-section');
            helpVisible = !helpVisible;
            helpSection.style.display = helpVisible ? 'block' : 'none';
            
            const helpBtn = document.getElementById('help-btn');
            helpBtn.innerHTML = helpVisible ? 
                '<i class="fas fa-eye-slash mr-2"></i>Ocultar Ayuda' : 
                '<i class="fas fa-lightbulb mr-2"></i>Ayuda';
        }

        function selectAnswer(optionIndex) {
            const question = questions[currentQuestion];
            const isCorrect = optionIndex === question.correct;
            const points = isCorrect ? 1.25 : 0;
            
            answers[currentQuestion] = {
                selected: optionIndex,
                correct: isCorrect,
                points: points
            };
            
            updateProgress();
        }

        function selectAnswerInput() {
            const inputValue = parseFloat(document.getElementById('answer-input').value);
            const question = questions[currentQuestion];
            const isCorrect = Math.abs(inputValue - question.answer) <= question.tolerance;
            const points = isCorrect ? 1.25 : 0;
            
            answers[currentQuestion] = {
                selected: inputValue,
                correct: isCorrect,
                points: points
            };
            
            updateProgress();
        }

        function previousQuestion() {
            if (currentQuestion > 0) {
                currentQuestion--;
                showQuestion(currentQuestion);
                helpVisible = false;
                document.getElementById('help-section').style.display = 'none';
                document.getElementById('help-btn').innerHTML = '<i class="fas fa-lightbulb mr-2"></i>Ayuda';
            }
        }

        function nextQuestion() {
            if (currentQuestion < questions.length - 1) {
                currentQuestion++;
                showQuestion(currentQuestion);
                helpVisible = false;
                document.getElementById('help-section').style.display = 'none';
                document.getElementById('help-btn').innerHTML = '<i class="fas fa-lightbulb mr-2"></i>Ayuda';
            } else {
                finishTest();
            }
        }

        function updateProgress() {
            const answered = Object.keys(answers).length;
            const score = Object.values(answers).reduce((sum, ans) => sum + ans.points, 0);
            const percentage = ((answered / questions.length) * 100).toFixed(1);
            
            document.getElementById('progress').textContent = `${answered}/40`;
            document.getElementById('score').textContent = `${score.toFixed(1)}/50`;
            document.getElementById('percentage').textContent = `${percentage}%`;
            
            totalScore = score;
        }

        function finishTest() {
            document.getElementById('question-container').style.display = 'none';
            document.getElementById('results-section').style.display = 'block';
            showFinalResults();
        }

        function showFinalResults() {
            const finalScore = Object.values(answers).reduce((sum, ans) => sum + ans.points, 0);
            const percentage = (finalScore / 50 * 100).toFixed(1);
            
            let grade, gradeDesc, color;
            if (percentage >= 90) {
                grade = "Excelente";
                gradeDesc = "Dominio superior de distribución normal";
                color = "text-green-600";
            } else if (percentage >= 80) {
                grade = "Muy Bueno";
                gradeDesc = "Buen manejo de conceptos estadísticos";
                color = "text-blue-600";
            } else if (percentage >= 70) {
                grade = "Bueno";
                gradeDesc = "Comprensión adecuada, revisar algunos temas";
                color = "text-yellow-600";
            } else if (percentage >= 60) {
                grade = "Regular";
                gradeDesc = "Necesita reforzar conceptos fundamentales";
                color = "text-orange-600";
            } else {
                grade = "Insuficiente";
                gradeDesc = "Requiere estudio adicional de distribución normal";
                color = "text-red-600";
            }
            
            document.getElementById('final-results').innerHTML = `
                <div class="bg-gradient-to-r from-blue-100 to-purple-100 p-6 rounded-lg">
                    <h3 class="text-2xl font-bold ${color} mb-2">${grade}</h3>
                    <p class="text-lg mb-4">${gradeDesc}</p>
                    <div class="grid grid-cols-2 gap-4 text-center">
                        <div class="bg-white p-4 rounded">
                            <div class="text-3xl font-bold text-blue-600">${finalScore.toFixed(1)}</div>
                            <div class="text-sm text-gray-600">Puntos de 50</div>
                        </div>
                        <div class="bg-white p-4 rounded">
                            <div class="text-3xl font-bold text-purple-600">${percentage}%</div>
                            <div class="text-sm text-gray-600">Porcentaje</div>
                        </div>
                    </div>
                </div>
            `;
            
            // Detailed results
            const correct = Object.values(answers).filter(ans => ans.correct).length;
            const incorrect = Object.values(answers).length - correct;
            
            document.getElementById('detailed-results').innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="bg-green-100 p-4 rounded-lg text-center">
                        <div class="text-2xl font-bold text-green-600">${correct}</div>
                        <div class="text-sm text-green-700">Respuestas Correctas</div>
                    </div>
                    <div class="bg-red-100 p-4 rounded-lg text-center">
                        <div class="text-2xl font-bold text-red-600">${incorrect}</div>
                        <div class="text-sm text-red-700">Respuestas Incorrectas</div>
                    </div>
                    <div class="bg-gray-100 p-4 rounded-lg text-center">
                        <div class="text-2xl font-bold text-gray-600">${40 - Object.keys(answers).length}</div>
                        <div class="text-sm text-gray-700">Sin Responder</div>
                    </div>
                </div>
                
                <div class="mt-6 p-4 bg-blue-50 rounded-lg">
                    <h4 class="font-bold text-lg mb-2">📚 Recomendaciones de Estudio:</h4>
                    <ul class="list-disc list-inside space-y-1 text-sm">
                        <li>Revisar el uso de la tabla de distribución normal estándar</li>
                        <li>Practicar la estandarización de variables (cálculo de z-score)</li>
                        <li>Reforzar la interpretación de percentiles y probabilidades</li>
                        <li>Estudiar aplicaciones en control de calidad farmacéutica</li>
                        <li>Practicar con casos reales de la industria farmacéutica</li>
                    </ul>
                </div>
            `;
        }
    </script>
</body>
</html>